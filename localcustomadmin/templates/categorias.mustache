<!-- Elegant Categories Management Interface -->
<div class="elegant-categories-container">
    
    <!-- Hero Header with Gradient -->
    <div class="hero-header">
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">
                    <i class="fas fa-sitemap hero-icon"></i>
                    Gerenciamento de Categorias
                </h1>
                <p class="hero-subtitle">
                    Organize e estruture seus cursos de forma intuitiva
                </p>
            </div>
            
            {{#stats}}
            <div class="hero-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-folder"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number">{{total_categories}}</span>
                        <span class="stat-label">Categorias</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number">{{total_courses}}</span>
                        <span class="stat-label">Cursos</span>
                    </div>
                </div>
            </div>
            {{/stats}}
        </div>
    </div>

    <!-- Elegant Action Bar -->
    <div class="elegant-action-bar">
        <div class="action-left">
            <a href="{{add_category_url}}" class="btn-elegant btn-primary">
                <span class="btn-icon">
                    <i class="fas fa-plus"></i>
                </span>
                <span class="btn-text">Nova Categoria</span>
            </a>
        </div>
        
        {{#has_categories}}
        <div class="action-right">
            <div class="control-group">
                <button class="btn-elegant btn-ghost" type="button" id="expandAllBtn">
                    <span class="btn-icon">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </span>
                    <span class="btn-text">Expandir</span>
                </button>
                <button class="btn-elegant btn-ghost" type="button" id="collapseAllBtn">
                    <span class="btn-icon">
                        <i class="fas fa-compress-arrows-alt"></i>
                    </span>
                    <span class="btn-text">Colapsar</span>
                </button>
            </div>
        </div>
        {{/has_categories}}
    </div>

    {{#has_categories}}
    <!-- Elegant Tree Container -->
    <div class="elegant-tree-container">
        <div class="tree-header">
            <div class="tree-title">
                <i class="fas fa-stream"></i>
                <span>Estrutura Hierárquica</span>
            </div>
            <div class="tree-search">
                <input type="text" class="search-input" placeholder="Buscar categoria..." id="categorySearch">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>
        
        <div class="tree-content" id="categoriesTree">
            {{#categories}}
            {{>local_localcustomadmin/elegant_category_node}}
            {{/categories}}
        </div>
    </div>
    {{/has_categories}}

    {{^has_categories}}
    <!-- Elegant Empty State -->
    <div class="elegant-empty-state">
        <div class="empty-animation">
            <div class="empty-circle"></div>
            <div class="empty-icon">
                <i class="fas fa-folder-plus"></i>
            </div>
        </div>
        <div class="empty-content">
            <h3>Pronto para começar?</h3>
            <p>Crie sua primeira categoria e organize seus cursos de forma inteligente</p>
            <a href="{{add_category_url}}" class="btn-elegant btn-primary btn-large">
                <span class="btn-icon">
                    <i class="fas fa-rocket"></i>
                </span>
                <span class="btn-text">Começar Agora</span>
            </a>
        </div>
    </div>
    {{/has_categories}}

    <!-- Elegant Footer -->
    <div class="elegant-footer">
        <div class="footer-actions">
            <a href="{{back_to_courses_url}}" class="btn-elegant btn-ghost">
                <span class="btn-icon">
                    <i class="fas fa-arrow-left"></i>
                </span>
                <span class="btn-text">Voltar para Cursos</span>
            </a>
        </div>
        <div class="footer-info">
            <span class="footer-text">Organizando conhecimento com elegância</span>
        </div>
    </div>
</div>

{{#has_categories}}
<!-- Elegant Tree JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    initElegantTree();
});

function initElegantTree() {
    // Initialize search functionality
    initCategorySearch();
    
    // Initialize tree interactions
    initTreeInteractions();
    
    // Add elegant entrance animations
    addEntranceAnimations();
}

function initCategorySearch() {
    const searchInput = document.getElementById('categorySearch');
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const nodes = document.querySelectorAll('.elegant-node');
            
            nodes.forEach(node => {
                const categoryName = node.dataset.categoryName.toLowerCase();
                const matches = categoryName.includes(searchTerm);
                
                if (matches || searchTerm === '') {
                    node.style.display = 'block';
                    node.classList.add('search-highlight');
                    setTimeout(() => node.classList.remove('search-highlight'), 300);
                } else {
                    node.style.display = 'none';
                }
            });
        });
    }
}

function initTreeInteractions() {
    // Node expansion
    document.querySelectorAll('.node-header[data-toggle="expand"]').forEach(header => {
        header.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (e.target.closest('.action-btn')) return;
            
            const targetId = this.getAttribute('data-target');
            const target = document.querySelector(targetId);
            const expandBtn = this.querySelector('.expand-btn i');
            const nodeIcon = this.querySelector('.node-icon i');
            
            if (target) {
                const isExpanded = target.classList.contains('expanded');
                
                if (isExpanded) {
                    // Collapse
                    target.classList.remove('expanded');
                    expandBtn.style.transform = 'rotate(0deg)';
                    nodeIcon.className = 'fas fa-folder';
                    this.setAttribute('aria-expanded', 'false');
                } else {
                    // Expand
                    target.classList.add('expanded');
                    expandBtn.style.transform = 'rotate(90deg)';
                    nodeIcon.className = 'fas fa-folder-open';
                    this.setAttribute('aria-expanded', 'true');
                }
                
                // Add ripple effect
                addRippleEffect(this, e);
            }
        });
    });
    
    // Control buttons
    const expandAllBtn = document.getElementById('expandAllBtn');
    const collapseAllBtn = document.getElementById('collapseAllBtn');
    
    if (expandAllBtn) {
        expandAllBtn.addEventListener('click', function(e) {
            expandAllNodes();
            addRippleEffect(this, e);
        });
    }
    
    if (collapseAllBtn) {
        collapseAllBtn.addEventListener('click', function(e) {
            collapseAllNodes();
            addRippleEffect(this, e);
        });
    }
}

function expandAllNodes() {
    document.querySelectorAll('.node-children').forEach((node, index) => {
        setTimeout(() => {
            node.classList.add('expanded');
        }, index * 50); // Staggered animation
    });
    
    document.querySelectorAll('.expand-btn i').forEach(icon => {
        icon.style.transform = 'rotate(90deg)';
    });
    
    document.querySelectorAll('.node-icon i').forEach(icon => {
        if (icon.classList.contains('fa-folder')) {
            icon.className = 'fas fa-folder-open';
        }
    });
}

function collapseAllNodes() {
    document.querySelectorAll('.node-children').forEach((node, index) => {
        setTimeout(() => {
            node.classList.remove('expanded');
        }, index * 30);
    });
    
    document.querySelectorAll('.expand-btn i').forEach(icon => {
        icon.style.transform = 'rotate(0deg)';
    });
    
    document.querySelectorAll('.node-icon i').forEach(icon => {
        if (icon.classList.contains('fa-folder-open')) {
            icon.className = 'fas fa-folder';
        }
    });
}

function addEntranceAnimations() {
    // Staggered entrance animation for nodes
    document.querySelectorAll('.elegant-node').forEach((node, index) => {
        node.style.opacity = '0';
        node.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            // Don't override the transition - it's already in CSS
            node.style.opacity = '1';
            node.style.transform = 'translateY(0)';
        }, index * 100);
    });
}

function addRippleEffect(element, event) {
    const ripple = document.createElement('span');
    const rect = element.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = event.clientX - rect.left - size / 2;
    const y = event.clientY - rect.top - size / 2;
    
    ripple.className = 'elegant-ripple';
    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = x + 'px';
    ripple.style.top = y + 'px';
    
    element.appendChild(ripple);
    
    setTimeout(() => {
        ripple.remove();
    }, 600);
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const searchInput = document.getElementById('categorySearch');
        if (searchInput && document.activeElement === searchInput) {
            searchInput.value = '';
            searchInput.blur();
            // Reset search
            document.querySelectorAll('.elegant-node').forEach(node => {
                node.style.display = 'block';
            });
        }
    }
});
</script>
{{/has_categories}}

