<!-- Elegant Categories Management Interface -->
<div class="elegant-categories-container">
    
    <!-- Back Button -->
    <div class="back-button-container">
        <a href="{{back_to_courses_url}}" class="btn-back">
            <i class="fas fa-arrow-left"></i>
            Voltar
        </a>
    </div>
    
    <!-- Hero Header with Gradient -->
    <div class="hero-header">
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">
                    <i class="fas fa-sitemap hero-icon"></i>
                    Gerenciamento de Categorias
                </h1>
                <p class="hero-subtitle">
                    Organize e estruture seus cursos de forma intuitiva
                </p>
            </div>
            
            {{#stats}}
            <div class="hero-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-folder"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number">{{total_categories}}</span>
                        <span class="stat-label">Categorias</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number">{{total_courses}}</span>
                        <span class="stat-label">Cursos</span>
                    </div>
                </div>
            </div>
            {{/stats}}
        </div>
    </div>

    <!-- Elegant Action Bar -->
    <div class="elegant-action-bar">
        <div class="action-left">
            <a href="{{add_category_url}}" class="btn-elegant btn-primary">
                <span class="btn-icon">
                    <i class="fas fa-plus"></i>
                </span>
                <span class="btn-text">Nova Categoria</span>
            </a>
        </div>
        
        {{#has_categories}}
        <div class="action-right">
            <div class="control-group">
                <button class="btn-elegant btn-ghost" type="button" id="expandAllBtn">
                    <span class="btn-icon">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </span>
                    <span class="btn-text">Expandir</span>
                </button>
                <button class="btn-elegant btn-ghost" type="button" id="collapseAllBtn">
                    <span class="btn-icon">
                        <i class="fas fa-compress-arrows-alt"></i>
                    </span>
                    <span class="btn-text">Colapsar</span>
                </button>
            </div>
        </div>
        {{/has_categories}}
    </div>

    {{#has_categories}}
    <!-- Elegant Tree Container -->
    <div class="elegant-tree-container">
        <div class="tree-header">
            <div class="tree-title">
                <i class="fas fa-stream"></i>
                <span>Estrutura Hierárquica</span>
            </div>
            <div class="tree-search">
                <input type="text" class="search-input" placeholder="Buscar categoria..." id="categorySearch">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>
        
        <div class="tree-content" id="categoriesTree">
            {{#categories}}
            {{>local_localcustomadmin/elegant_category_node}}
            {{/categories}}
        </div>
    </div>
    {{/has_categories}}

    {{^has_categories}}
    <!-- Elegant Empty State -->
    <div class="elegant-empty-state">
        <div class="empty-animation">
            <div class="empty-circle"></div>
            <div class="empty-icon">
                <i class="fas fa-folder-plus"></i>
            </div>
        </div>
        <div class="empty-content">
            <h3>Pronto para começar?</h3>
            <p>Crie sua primeira categoria e organize seus cursos de forma inteligente</p>
            <a href="{{add_category_url}}" class="btn-elegant btn-primary btn-large">
                <span class="btn-icon">
                    <i class="fas fa-rocket"></i>
                </span>
                <span class="btn-text">Começar Agora</span>
            </a>
        </div>
    </div>
    {{/has_categories}}

    <!-- Elegant Footer -->
    <div class="elegant-footer">
        <div class="footer-info">
            <span class="footer-text">Organizando conhecimento com elegância</span>
        </div>
    </div>
</div>

{{#has_categories}}
<!-- Elegant Tree Accordion Functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize accordion after a short delay to ensure DOM is ready
    setTimeout(function() {
        initializeElegantAccordion();
    }, 500);
});

function initializeElegantAccordion() {
    // Setup click handlers for expandable elements
    var expandableElements = document.querySelectorAll('[data-toggle="expand"]');
    
    expandableElements.forEach(function(element) {
        element.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var targetId = this.getAttribute('data-target');
            var target = document.querySelector(targetId);
            
            if (target) {
                // Toggle expanded class
                target.classList.toggle('expanded');
                
                // Update button rotation
                var header = this.closest('.node-header');
                var expandBtn = header.querySelector('.expand-btn i');
                if (expandBtn) {
                    var isExpanded = target.classList.contains('expanded');
                    expandBtn.style.transform = isExpanded ? 'rotate(90deg)' : 'rotate(0deg)';
                }
            }
        });
    });
    
    // Setup expand/collapse all buttons
    var expandAllBtn = document.getElementById('expandAllBtn');
    var collapseAllBtn = document.getElementById('collapseAllBtn');
    
    if (expandAllBtn) {
        expandAllBtn.addEventListener('click', function(e) {
            e.preventDefault();
            expandAllNodes();
        });
    }
    
    if (collapseAllBtn) {
        collapseAllBtn.addEventListener('click', function(e) {
            e.preventDefault();
            collapseAllNodes();
        });
    }
}

function expandAllNodes() {
    var childNodes = document.querySelectorAll('.node-children');
    var expandBtns = document.querySelectorAll('.expand-btn i');
    
    childNodes.forEach(function(node, index) {
        setTimeout(function() {
            node.classList.add('expanded');
        }, index * 50);
    });
    
    expandBtns.forEach(function(btn) {
        btn.style.transform = 'rotate(90deg)';
    });
    
    // Update folder icons
    document.querySelectorAll('.node-icon i.fa-folder').forEach(function(icon) {
        icon.className = 'fas fa-folder-open';
    });
}

function collapseAllNodes() {
    var childNodes = document.querySelectorAll('.node-children');
    var expandBtns = document.querySelectorAll('.expand-btn i');
    
    childNodes.forEach(function(node, index) {
        setTimeout(function() {
            node.classList.remove('expanded');
        }, index * 30);
    });
    
    expandBtns.forEach(function(btn) {
        btn.style.transform = 'rotate(0deg)';
    });
    
    // Update folder icons
    document.querySelectorAll('.node-icon i.fa-folder-open').forEach(function(icon) {
        icon.className = 'fas fa-folder';
    });
}
</script>
{{/has_categories}}

<div class="container-fluid mt-4">
    <!-- Adicionar botão de sincronização -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Categorias e Preços</h2>
        <a href="process_sync_category_prices.php?action=sync_all" class="btn btn-primary">
            <i class="fa fa-sync-alt"></i> Sincronizar Preços do WordPress
        </a>
    </div>
    
    <!-- Tabela de preços existente -->
    <table class="table table-bordered table-hover">
        <!-- ...existing code... -->
    </table>
</div>

