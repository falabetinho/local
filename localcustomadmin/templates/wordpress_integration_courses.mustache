{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_localcustomadmin/wordpress_integration_courses

    WordPress Integration courses synchronization template.

    Context variables required for this template:
    * wordpress_enabled - Boolean
    * wordpress_endpoint - String
    * courses - Array of course objects
    * has_courses - Boolean
    * actions - Array of action buttons
    * category_options - Array of category filter options
    * back_url - URL to go back
    * has_manage_capability - Boolean
    * sesskey - Session key
}}

<div class="container-fluid mt-4">
    <!-- Page Header with Back Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">
                <i class="fa fa-graduation-cap mr-2 text-success"></i>
                {{#str}}wordpress_integration_courses, local_localcustomadmin{{/str}}
            </h2>
            <p class="text-muted mb-0">
                Sincronize cursos e pre√ßos entre Moodle e WordPress
            </p>
        </div>
        <a href="{{back_url}}" class="btn btn-outline-secondary">
            <i class="fa fa-arrow-left mr-1"></i>
            {{#str}}back, local_localcustomadmin{{/str}}
        </a>
    </div>

    {{#has_manage_capability}}
    <!-- WordPress Connection Info -->
    <div class="alert alert-info mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5 class="alert-heading mb-2">
                    <i class="fa fa-wordpress mr-2"></i>
                    {{#str}}wordpress_endpoint, local_localcustomadmin{{/str}}
                </h5>
                <p class="mb-0"><code>{{wordpress_endpoint}}</code></p>
            </div>
            <div class="col-md-4 text-right">
                <span class="badge badge-success badge-lg">
                    <i class="fa fa-check-circle"></i> {{#str}}connected, local_localcustomadmin{{/str}}
                </span>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">
                <i class="fa fa-bolt mr-2"></i>
                {{#str}}actions, local_localcustomadmin{{/str}}
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                {{#actions}}
                <div class="col-md-3 mb-3">
                    <div class="card h-100 border-{{variant}}">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="fa {{icon}} fa-3x text-{{variant}}"></i>
                            </div>
                            <h5 class="card-title">{{title}}</h5>
                            <p class="card-text text-muted">{{description}}</p>
                            {{#js_action}}
                            <button type="button" class="btn btn-{{variant}}" data-action="{{action}}">
                                <i class="fa {{icon}} mr-1"></i>
                                {{title}}
                            </button>
                            {{/js_action}}
                            {{^js_action}}
                            <a href="{{url}}" class="btn btn-{{variant}}">
                                <i class="fa {{icon}} mr-1"></i>
                                {{title}}
                            </a>
                            {{/js_action}}
                        </div>
                    </div>
                </div>
                {{/actions}}
            </div>
        </div>
    </div>

    <!-- Filter -->
    {{#has_courses}}
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" action="" class="form-inline">
                <label for="categoryid" class="mr-2">{{#str}}category{{/str}}:</label>
                <select name="categoryid" id="categoryid" class="form-control mr-2" onchange="this.form.submit()">
                    {{#category_options}}
                    <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                    {{/category_options}}
                </select>
                <button type="submit" class="btn btn-primary">
                    <i class="fa fa-filter"></i> {{#str}}filter{{/str}}
                </button>
            </form>
        </div>
    </div>

    <!-- Courses Table -->
    <div class="card shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fa fa-list mr-2"></i>
                {{#str}}courses{{/str}}
            </h5>
            <span class="badge badge-primary badge-pill">{{courses.length}}</span>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="thead-light">
                        <tr>
                            <th>ID</th>
                            <th>{{#str}}fullname, course{{/str}}</th>
                            <th>{{#str}}shortname, course{{/str}}</th>
                            <th>{{#str}}category{{/str}}</th>
                            <th>{{#str}}status{{/str}}</th>
                            <th>{{#str}}sync_status, local_localcustomadmin{{/str}}</th>
                            <th>{{#str}}last_sync, local_localcustomadmin{{/str}}</th>
                            <th>{{#str}}actions{{/str}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#courses}}
                        <tr>
                            <td><strong>{{id}}</strong></td>
                            <td>
                                <a href="{{courseurl}}" target="_blank">{{fullname}}</a>
                            </td>
                            <td><code>{{shortname}}</code></td>
                            <td>{{category}}</td>
                            <td>
                                {{#visible}}
                                <span class="badge badge-success">{{#str}}visible{{/str}}</span>
                                {{/visible}}
                                {{^visible}}
                                <span class="badge badge-secondary">{{#str}}hidden{{/str}}</span>
                                {{/visible}}
                            </td>
                            <td>
                                {{#synced}}
                                    {{#has_error}}
                                    <span class="badge badge-danger">{{#str}}error{{/str}}</span>
                                    {{/has_error}}
                                    {{^has_error}}
                                    <span class="badge badge-success">{{#str}}synced, local_localcustomadmin{{/str}}</span>
                                    {{/has_error}}
                                {{/synced}}
                                {{^synced}}
                                <span class="badge badge-warning">{{#str}}not_synced, local_localcustomadmin{{/str}}</span>
                                {{/synced}}
                            </td>
                            <td>
                                <small>{{last_synced}}</small>
                                {{#has_error}}
                                <br><small class="text-danger" title="{{sync_error}}">
                                    <i class="fa fa-exclamation-triangle"></i> {{#str}}error{{/str}}
                                </small>
                                {{/has_error}}
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button type="button" 
                                            class="btn btn-sm btn-primary" 
                                            data-action="sync-single-course" 
                                            data-courseid="{{id}}"
                                            title="{{#str}}sync_course, local_localcustomadmin{{/str}}">
                                        <i class="fa fa-sync"></i>
                                    </button>
                                    {{#synced}}
                                    <button type="button" 
                                            class="btn btn-sm btn-warning" 
                                            data-action="toggle-course-visibility" 
                                            data-courseid="{{id}}"
                                            data-visible="{{visible}}"
                                            title="{{#str}}toggle_visibility, local_localcustomadmin{{/str}}">
                                        {{#visible}}
                                        <i class="fa fa-eye-slash"></i>
                                        {{/visible}}
                                        {{^visible}}
                                        <i class="fa fa-eye"></i>
                                        {{/visible}}
                                    </button>
                                    <button type="button" 
                                            class="btn btn-sm btn-danger" 
                                            data-action="delete-course-wp" 
                                            data-courseid="{{id}}"
                                            title="{{#str}}delete_from_wp, local_localcustomadmin{{/str}}">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                    {{/synced}}
                                </div>
                            </td>
                        </tr>
                        {{/courses}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {{/has_courses}}

    {{^has_courses}}
    <div class="alert alert-info text-center">
        <i class="fa fa-info-circle fa-3x mb-3"></i>
        <h4>{{#str}}no_courses_found, local_localcustomadmin{{/str}}</h4>
        <p>{{#str}}no_courses_found_desc, local_localcustomadmin{{/str}}</p>
    </div>
    {{/has_courses}}

    {{/has_manage_capability}}
</div>

<style>
.badge-lg {
    font-size: 1rem;
    padding: 0.5rem 1rem;
}
.card {
    border-radius: 0.5rem;
}
.card-header {
    border-bottom: 2px solid #dee2e6;
}
</style>
