{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_localcustomadmin/wordpress_mappings

    WordPress mappings viewer template.

    Context variables required for this template:
    * mappings - Array of mapping objects
    * has_mappings - Boolean indicating if there are mappings
    * total_count - Total number of mappings
    * statistics - Statistics object
}}

<div class="wordpress-mappings-container">
    
    <!-- Page Header with Back Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">
                <i class="fa fa-table mr-2"></i>
                {{#str}}wordpress_mappings, local_localcustomadmin{{/str}}
            </h2>
            <p class="text-muted mb-0">
                {{#str}}wordpress_mappings_desc, local_localcustomadmin{{/str}}
            </p>
        </div>
        <a href="{{back_url}}" class="btn btn-outline-secondary">
            <i class="fa fa-arrow-left mr-1"></i>
            {{#str}}back, local_localcustomadmin{{/str}}
        </a>
    </div>
    
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="text-muted">{{#str}}total{{/str}}</h5>
                    <h2 class="mb-0">{{statistics.total}}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="text-muted">{{#str}}categories{{/str}}</h5>
                    <h2 class="mb-0">{{statistics.categories}}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="text-muted">{{#str}}courses{{/str}}</h5>
                    <h2 class="mb-0">{{statistics.courses}}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center border-success">
                <div class="card-body">
                    <h5 class="text-success">{{#str}}synced, local_localcustomadmin{{/str}}</h5>
                    <h2 class="mb-0 text-success">{{statistics.synced}}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center border-warning">
                <div class="card-body">
                    <h5 class="text-warning">{{#str}}pending, local_localcustomadmin{{/str}}</h5>
                    <h2 class="mb-0 text-warning">{{statistics.pending}}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center border-danger">
                <div class="card-body">
                    <h5 class="text-danger">{{#str}}error{{/str}}</h5>
                    <h2 class="mb-0 text-danger">{{statistics.errors}}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" action="" class="form-inline">
                <div class="form-group mr-3">
                    <label for="type" class="mr-2">{{#str}}type, local_localcustomadmin{{/str}}:</label>
                    <select name="type" id="type" class="form-control" onchange="this.form.submit()">
                        {{#type_options}}
                        <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                        {{/type_options}}
                    </select>
                </div>
                <div class="form-group mr-3">
                    <label for="status" class="mr-2">{{#str}}status{{/str}}:</label>
                    <select name="status" id="status" class="form-control" onchange="this.form.submit()">
                        {{#status_options}}
                        <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                        {{/status_options}}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fa fa-filter"></i> {{#str}}filter{{/str}}
                </button>
            </form>
        </div>
    </div>

    <!-- Mappings Table -->
    {{#has_mappings}}
    <div class="card">
        <div class="card-header">
            <h4 class="mb-0">
                <i class="fa fa-table"></i> 
                {{#str}}wordpress_mappings, local_localcustomadmin{{/str}}
                <span class="badge badge-secondary ml-2">{{total_count}}</span>
            </h4>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="thead-light">
                        <tr>
                            <th>ID</th>
                            <th>{{#str}}type, local_localcustomadmin{{/str}}</th>
                            <th>Moodle</th>
                            <th>WordPress</th>
                            <th>{{#str}}status{{/str}}</th>
                            <th>{{#str}}last_sync, local_localcustomadmin{{/str}}</th>
                            <th>{{#str}}actions{{/str}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#mappings}}
                        <tr>
                            <td><code>#{{id}}</code></td>
                            <td>
                                <span class="badge badge-info">{{moodle_type_label}}</span>
                            </td>
                            <td>
                                <strong>{{moodle_name}}</strong><br>
                                <small class="text-muted">
                                    ID: {{moodle_id}}
                                    {{#moodle_idnumber}}
                                    | IDNumber: {{moodle_idnumber}}
                                    {{/moodle_idnumber}}
                                </small>
                            </td>
                            <td>
                                <strong>{{wordpress_type}}</strong> #{{wordpress_id}}<br>
                                <small class="text-muted">
                                    {{#wordpress_taxonomy}}
                                    Taxonomy: <code>{{wordpress_taxonomy}}</code>
                                    {{/wordpress_taxonomy}}
                                    {{#wordpress_post_type}}
                                    Post Type: <code>{{wordpress_post_type}}</code>
                                    {{/wordpress_post_type}}
                                </small>
                            </td>
                            <td>
                                <span class="badge badge-{{sync_status_class}}">
                                    {{sync_status_label}}
                                </span>
                                {{#has_error}}
                                <br>
                                <small class="text-danger" title="{{sync_error}}">
                                    <i class="fa fa-exclamation-triangle"></i> 
                                    {{#str}}error{{/str}}
                                </small>
                                {{/has_error}}
                            </td>
                            <td>
                                <small>{{last_synced}}</small>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info" 
                                        data-toggle="collapse" 
                                        data-target="#details-{{id}}"
                                        title="{{#str}}showdetails, local_localcustomadmin{{/str}}">
                                    <i class="fa fa-info-circle"></i>
                                </button>
                            </td>
                        </tr>
                        {{#has_error}}
                        <tr class="collapse" id="details-{{id}}">
                            <td colspan="7" class="bg-light">
                                <div class="alert alert-danger mb-0">
                                    <strong><i class="fa fa-exclamation-triangle"></i> {{#str}}error_message, local_localcustomadmin{{/str}}:</strong>
                                    <pre class="mb-0 mt-2">{{sync_error}}</pre>
                                </div>
                            </td>
                        </tr>
                        {{/has_error}}
                        {{^has_error}}
                        <tr class="collapse" id="details-{{id}}">
                            <td colspan="7" class="bg-light">
                                <dl class="row mb-0">
                                    <dt class="col-sm-3">{{#str}}timecreated, local_localcustomadmin{{/str}}</dt>
                                    <dd class="col-sm-9">{{timecreated}}</dd>
                                    
                                    <dt class="col-sm-3">{{#str}}timemodified, local_localcustomadmin{{/str}}</dt>
                                    <dd class="col-sm-9">{{timemodified}}</dd>
                                </dl>
                            </td>
                        </tr>
                        {{/has_error}}
                        {{/mappings}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {{/has_mappings}}

    {{^has_mappings}}
    <div class="alert alert-info text-center">
        <i class="fa fa-info-circle fa-3x mb-3"></i>
        <h4>{{#str}}no_mappings_found, local_localcustomadmin{{/str}}</h4>
        <p>{{#str}}no_mappings_found_desc, local_localcustomadmin{{/str}}</p>
    </div>
    {{/has_mappings}}

</div>

<style>
.wordpress-mappings-container {
    padding: 20px;
}
.breadcrumb-nav {
    margin-bottom: 20px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
}
.card {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}
.table td, .table th {
    vertical-align: middle;
}
pre {
    white-space: pre-wrap;
    word-wrap: break-word;
}
</style>
