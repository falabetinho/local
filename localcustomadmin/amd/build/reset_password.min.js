define(["jquery","core/modal_factory","core/str","core/ajax","core/notification"],function(n,l,e,d,i){return{open:function(t){console.log("[reset_password.open] Called with userId:",t);var o=[e.get_string("resetpassword","local_localcustomadmin"),e.get_string("newpassword","local_localcustomadmin"),e.get_string("confirmpassword","local_localcustomadmin"),e.get_string("passwordmustmatch","local_localcustomadmin"),e.get_string("passwordempty","local_localcustomadmin")];n.when.apply(n,o).done(function(o,e,s,r,a){console.log("[reset_password.open] Strings loaded");e=n(`
                <div class="reset-password-form">
                    <div class="form-group mb-3">
                        <label for="newPassword" class="form-label">${e}</label>
                        <input type="password" class="form-control" id="newPassword" required>
                        <small class="form-text text-muted">${a}</small>
                    </div>
                    <div class="form-group mb-3">
                        <label for="confirmPassword" class="form-label">${s}</label>
                        <input type="password" class="form-control" id="confirmPassword" required>
                    </div>
                    <div id="passwordError" class="alert alert-danger d-none" role="alert">
                        ${r}
                    </div>
                </div>
            `);l.create({type:l.types.SAVE_CANCEL,title:o,body:e}).done(function(a){console.log("[reset_password.open] Modal created successfully"),a.userId=t,a.getRoot().on("click",'[data-action="save"]',function(o){o.preventDefault(),console.log("[reset_password.open] Save button clicked");var e=a;console.log("[reset_password.handleSubmit] Starting submit");var s=(o=e.getRoot()).find("#newPassword").val().trim(),r=o.find("#confirmPassword").val().trim(),o=o.find("#passwordError");s&&r?s!==r?(o.removeClass("d-none"),console.log("[reset_password.handleSubmit] Passwords do not match")):(o.addClass("d-none"),console.log("[reset_password.handleSubmit] Sending to server - userId:",e.userId),d.call([{methodname:"local_localcustomadmin_reset_password",method:"post",args:{userid:e.userId,password:s},done:function(o){console.log("[reset_password.handleSubmit] Success:",o),i.addNotification({message:"Senha alterada com sucesso!",type:"success"}),setTimeout(function(){e.destroy()},1500)},fail:function(o){console.error("[reset_password.handleSubmit] Error:",o);let e="Erro ao alterar a senha. Tente novamente.";o&&o.error&&(e=o.error),i.addNotification({message:e,type:"danger"})}}])):(o.removeClass("d-none"),console.log("[reset_password.handleSubmit] Passwords are empty"))}),a.show()}).fail(function(o){console.error("[reset_password.open] Modal creation failed:",o),i.addNotification({message:"Erro ao criar o modal",type:"danger"})})}).fail(function(o){console.error("[reset_password.open] Error loading strings:",o),i.addNotification({message:"Erro ao carregar strings",type:"danger"})})}}});
//# sourceMappingURL=reset_password.min.js.map