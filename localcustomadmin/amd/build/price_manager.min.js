define(["jquery","core/notification","core/modal","core/modal_factory"],function(o,n,e,t){return{init:function(e){this.categoryId=e,this.setupEventHandlers(),this.loadPrices()},setupEventHandlers:function(){var t=this;o(document).on("click","#btn-add-price",function(){t.showPriceForm(null)}),o(document).on("click","#btn-save-price",function(){t.savePrice()}),o(document).on("click",".btn-edit-price",function(e){e.preventDefault();e=o(this).data("price-id");t.editPrice(e)}),o(document).on("click",".btn-delete-price",function(e){e.preventDefault();e=o(this).data("price-id");t.deletePrice(e)})},loadPrices:function(){var t=this;o.ajax({type:"POST",url:M.cfg.wwwroot+"/webservice/rest/server.php",dataType:"json",data:{wsfunction:"local_localcustomadmin_get_category_prices",categoryid:t.categoryId,moodlewsrestformat:"json"},success:function(e){t.renderPricesTable(e)},error:function(e,t,r){console.error("Error loading prices:",r),n.exception(new Error("Failed to load prices"))}})},renderPricesTable:function(e){var r=o("#prices-tbody");r.html(""),e&&0!==e.length?e.forEach(function(e){var t="<tr>",t=(t=(t+="<td>R$ "+parseFloat(e.price).toFixed(2)+"</td>")+("<td>"+new Date(1e3*e.validity_start).toLocaleString()+"</td>"))+("<td>"+(e.validity_end?new Date(1e3*e.validity_end).toLocaleString():"-")+"</td>");r.append(t=(t=(t=t+('<td><span class="badge '+(1==e.status?"bg-success":"bg-danger")+'">'+(1==e.status?"Active":"Inactive")+"</span></td>")+"<td>")+('<button type="button" class="btn btn-sm btn-warning me-2 btn-edit-price" data-price-id="'+e.id+'"><i class="fas fa-edit"></i></button>')+('<button type="button" class="btn btn-sm btn-danger btn-delete-price" data-price-id="'+e.id+'"><i class="fas fa-trash"></i></button>'))+"</td>"+"</tr>")}):r.html('<tr><td colspan="5" class="text-center text-muted">No prices found. Click "Add Price" to create one.</td></tr>')},showPriceForm:function(e){var t=e?"Edit Price":"Add Price";o("#priceModalLabel").text(t),e?(o("#price_id").val(e.id),o("#price-value").val(e.price),o("#validity-start").val(new Date(1e3*e.validity_start).toISOString().slice(0,16)),o("#validity-end").val(e.validity_end?new Date(1e3*e.validity_end).toISOString().slice(0,16):""),o("#price-status").val(e.status)):this.resetPriceForm(),new bootstrap.Modal(document.getElementById("priceModal")).show()},editPrice:function(t){var r=this;o.ajax({type:"POST",url:M.cfg.wwwroot+"/webservice/rest/server.php",dataType:"json",data:{wsfunction:"local_localcustomadmin_get_category_prices",categoryid:r.categoryId,moodlewsrestformat:"json"},success:function(e){e=e.find(function(e){return e.id==t});e&&r.showPriceForm(e)},error:function(){n.exception(new Error("Failed to load price details"))}})},savePrice:function(){var t=this,r=o("#price_id").val(),e=o("#price-value").val(),i=new Date(o("#validity-start").val()).getTime()/1e3,a=o("#validity-end").val()?new Date(o("#validity-end").val()).getTime()/1e3:null,c=o("#price-status").val();!e||e<=0?n.alert("Please enter a valid price","Validation Error"):!i||isNaN(i)?n.alert("Please enter a valid start date","Validation Error"):(e={wsfunction:r?"local_localcustomadmin_update_category_price":"local_localcustomadmin_create_category_price",categoryid:t.categoryId,price:e,validity_start:i,status:c,moodlewsrestformat:"json"},r&&(e.id=r),a&&(e.validity_end=a),o.ajax({type:"POST",url:M.cfg.wwwroot+"/webservice/rest/server.php",dataType:"json",data:e,success:function(e){e.success?(bootstrap.Modal.getInstance(document.getElementById("priceModal")).hide(),t.loadPrices(),n.alert(r?"Price updated successfully":"Price created successfully","Success")):n.alert(e.error||"Error saving price","Error")},error:function(e,t,r){console.error("Error saving price:",r),n.exception(new Error("Failed to save price"))}}))},deletePrice:function(e){var t=this;confirm("Are you sure you want to delete this price?")&&o.ajax({type:"POST",url:M.cfg.wwwroot+"/webservice/rest/server.php",dataType:"json",data:{wsfunction:"local_localcustomadmin_delete_category_price",id:e,moodlewsrestformat:"json"},success:function(e){e.success?(t.loadPrices(),n.alert("Price deleted successfully","Success")):n.alert(e.error||"Error deleting price","Error")},error:function(){n.exception(new Error("Failed to delete price"))}})},resetPriceForm:function(){o("#price-form")[0].reset(),o("#price_id").val("")}}});
//# sourceMappingURL=price_manager.min.js.map