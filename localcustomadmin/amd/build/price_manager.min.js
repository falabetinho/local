define(["jquery","core/notification","core/modal","core/modal_factory"],function(p,u,e,a){return{getBootstrap:function(){return"undefined"!=typeof window&&window.bootstrap?window.bootstrap:null},init:function(e){this.categoryId=e,this.setupEventHandlers(),this.loadPrices()},setupEventHandlers:function(){var a=this;p(document).on("click","#btn-add-price",function(){a.showPriceForm(null)}),p(document).on("click","#btn-save-price",function(){a.savePrice()}),p(document).on("click",".btn-edit-price",function(e){e.preventDefault(),console.log("Edit button clicked");e=p(this).data("price-id");console.log("Price ID:",e),a.editPrice(e)}),p(document).on("click",".btn-delete-price",function(e){e.preventDefault();e=p(this).data("price-id");a.deletePrice(e)}),p(document).on("click","#priceModal .btn-close",function(e){e.preventDefault(),a.closeModal()}),p(document).on("click",'#priceModal .btn-secondary[data-bs-dismiss="modal"]',function(e){e.preventDefault(),a.closeModal()}),p(document).on("click","#priceModal",function(e){"priceModal"===e.target.id&&a.closeModal()}),p(document).on("keydown",function(e){"Escape"===e.key&&p("#priceModal").hasClass("show")&&a.closeModal()})},loadPrices:function(){var r=this;p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:{action:"getprices",categoryid:r.categoryId,activeonly:!0},success:function(e){console.log("Price response:",e),e.success&&e.data&&Array.isArray(e.data)?r.renderPricesTable(e.data):(console.warn("Invalid price data received:",e.data),r.renderPricesTable([]))},error:function(e,a,t){console.log("No prices loaded or service error:",t),r.renderPricesTable([])}})},renderPricesTable:function(e){var t=p("#prices-tbody");t.html(""),Array.isArray(e)&&0!==e.length?e.forEach(function(e,a){a='<tr class="price-row" style="animation-delay: '+.05*a+'s">',a=(a=(a=(a+='<td class="price-name-cell"><div class="price-name-wrapper"><i class="fas fa-tag price-icon mr-2"></i>')+'<strong class="price-name">'+(e.name||"-")+'</strong></div></td><td class="price-value-cell">')+'<span class="price-amount">R$ '+parseFloat(e.price).toFixed(2)+'</span></td><td class="date-cell"><i class="fas fa-calendar-check mr-2 date-icon"></i>')+'<span class="date-text">'+new Date(1e3*e.startdate).toLocaleDateString("pt-BR")+'</span></td><td class="date-cell">';e.enddate?a=(a+='<i class="fas fa-calendar-times mr-2 date-icon"></i>')+'<span class="date-text">'+new Date(1e3*e.enddate).toLocaleDateString("pt-BR")+"</span>":a+='<span class="text-muted"><i class="fas fa-infinity mr-2"></i>Indefinido</span>',t.append(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a+="</td>")+'<td class="badge-cell">'+(1==e.ispromotional?'<span class="elegant-badge badge-promotional"><i class="fas fa-percentage mr-2"></i>Sim</span>':'<span class="elegant-badge badge-default"><i class="fas fa-minus mr-2"></i>Não</span>'))+"</td>"+'<td class="badge-cell">')+(1==e.isenrollmentfee?'<span class="elegant-badge badge-enrollment"><i class="fas fa-graduation-cap mr-2"></i>Sim</span>':'<span class="elegant-badge badge-default"><i class="fas fa-minus mr-2"></i>Não</span>')+"</td>")+'<td class="installments-cell">'+'<span class="installments-value">')+'<i class="fas fa-credit-card mr-2"></i>'+(e.installments+"x"))+"</span>"+"</td>")+'<td class="badge-cell">'+(1==e.status?'<span class="elegant-badge badge-active"><i class="fas fa-check-circle mr-2"></i>Ativo</span>':'<span class="elegant-badge badge-inactive"><i class="fas fa-times-circle mr-2"></i>Inativo</span>'))+"</td>"+'<td class="actions-cell">')+'<div class="action-buttons">'+('<button type="button" class="btn-action btn-action-edit btn-edit-price" data-price-id="'+e.id+'" title="Editar"><i class="fas fa-edit"></i></button>'))+('<button type="button" class="btn-action btn-action-delete btn-delete-price" data-price-id="'+e.id+'" title="Excluir"><i class="fas fa-trash-alt"></i></button>')+"</div>")+"</td>"+"</tr>")}):t.html('<tr class="empty-state-row"><td colspan="9" class="empty-state-cell"><div class="empty-state-content"><i class="fas fa-inbox empty-icon"></i><p class="empty-message">Nenhum preço encontrado</p><p class="empty-hint">Clique em "Adicionar Preço" para criar um novo</p></div></td></tr>')},showPriceForm:function(e){var a=this,t=(console.log("showPriceForm called with data:",e),e?"Edit Price":"Add Price"),t=(a.hideErrorAlert(),p("#priceModalLabel").text(t),console.log("Modal title set to:",t),e?(p("#price_id").val(e.id),p("#price-name").val(e.name||""),p("#price-value").val(e.price),p("#validity-start").val(new Date(1e3*e.startdate).toISOString().slice(0,16)),p("#validity-end").val(e.enddate?new Date(1e3*e.enddate).toISOString().slice(0,16):""),p("#is-promotional").prop("checked",1==e.ispromotional),p("#is-enrollment-fee").prop("checked",1==e.isenrollmentfee),p("#scheduled-task").prop("checked",1==e.scheduledtask),p("#installments").val(e.installments||0),p("#price-status").val(e.status)):(a.resetPriceForm(),a.initializeDateFields()),a.getBootstrap());if(console.log("Bootstrap object:",t),t)try{console.log("Creating new modal instance");var r=document.getElementById("priceModal"),i=(console.log("Modal element found:",r),new t.Modal(r));console.log("Modal instance created:",i),i.show(),console.log("Modal shown")}catch(e){console.error("Error showing modal with Bootstrap:",e),p("#priceModal").modal("show")}else console.log("Bootstrap not available, using jQuery modal"),p("#priceModal").modal("show")},initializeDateFields:function(){var e=new Date,a=(e.setHours(0,0,0,0),this.formatDateForInput(e)),a=(p("#validity-start").val(a),new Date(e)),e=(a.setFullYear(a.getFullYear()+5),this.formatDateForInput(a));p("#validity-end").val(e)},formatDateForInput:function(e){return e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")+"T"+String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")},editPrice:function(r){var i=this;console.log("editPrice called with ID:",r),p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:{action:"getprices",categoryid:i.categoryId,activeonly:!1},success:function(e){var a,t;console.log("Edit AJAX response:",e),e.success&&Array.isArray(e.data)&&0<e.data.length?(a=parseInt(r,10),t=e.data.find(function(e){return parseInt(e.id,10)===a}),console.log("Found price:",t),t?i.showPriceForm(t):console.warn("Price not found with ID:",r,"in data:",e.data)):console.warn("Invalid response data:",e.data)},error:function(e,a,t){console.error("Edit AJAX error:",t),i.showErrorAlert("Failed to load price details")}})},savePrice:function(){var r=this,i=p("#price_id").val(),e=p("#price-name").val(),a=p("#price-value").val(),t=new Date(p("#validity-start").val()).getTime()/1e3,o=p("#validity-end").val()?new Date(p("#validity-end").val()).getTime()/1e3:null,s=p("#is-promotional").is(":checked")?1:0,c=p("#is-enrollment-fee").is(":checked")?1:0,l=p("#scheduled-task").is(":checked")?1:0,n=parseInt(p("#installments").val())||0,d=p("#price-status").val();e&&""!==e.trim()?!a||a<=0?u.alert("Please enter a valid price","Validation Error"):!t||isNaN(t)?u.alert("Please enter a valid start date","Validation Error"):n<0?u.alert("Installments cannot be negative","Validation Error"):(e={action:i?"updateprice":"createprice",categoryid:r.categoryId,name:e,price:a,startdate:t,enddate:o||null,ispromotional:s,isenrollmentfee:c,scheduledtask:l,installments:n,status:d},i&&(e.id=i),p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:e,success:function(e){if(e.success){var a=r.getBootstrap();if(a)try{var t=a.Modal.getInstance(document.getElementById("priceModal"));t&&t.hide()}catch(e){console.log("Bootstrap hide failed, using jQuery"),p("#priceModal").modal("hide")}else p("#priceModal").modal("hide");r.loadPrices(),u.alert(i?"Price updated successfully":"Price created successfully","Success")}else r.showErrorAlert(e.error||"Error saving price")},error:function(e,a,t){console.error("Error saving price:",t);t="Failed to save price";try{e.responseJSON&&e.responseJSON.error&&(t=e.responseJSON.error)}catch(e){}r.showErrorAlert(t)}})):u.alert("Please enter a price name","Validation Error")},showErrorAlert:function(e){var a=p("#price-alert");p("#price-alert-message").text(e),a.removeClass("alert-success alert-info").addClass("alert-danger"),a.show(),setTimeout(function(){a.fadeOut()},5e3)},hideErrorAlert:function(){p("#price-alert").hide().removeClass("alert-danger alert-success alert-info")},deletePrice:function(e){var a=this;confirm("Are you sure you want to delete this price?")&&p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:{action:"deleteprice",categoryid:a.categoryId,id:e},success:function(e){e.success?(a.loadPrices(),u.alert("Price deleted successfully","Success")):u.alert(e.error||"Error deleting price","Error")},error:function(){u.exception(new Error("Failed to delete price"))}})},closeModal:function(){var e=this.getBootstrap();if(e)try{var a=document.getElementById("priceModal"),t=e.Modal.getInstance(a);(t=t||new e.Modal(a)).hide()}catch(e){console.log("Bootstrap hide failed, using jQuery",e),p("#priceModal").modal("hide")}else p("#priceModal").modal("hide");this.resetPriceForm(),this.hideErrorAlert()},resetPriceForm:function(){p("#price-form")[0].reset(),p("#price_id").val("")}}});
//# sourceMappingURL=price_manager.min.js.map