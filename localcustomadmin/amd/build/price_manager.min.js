define(["jquery","core/notification","core/modal","core/modal_factory"],function(p,u,e,t){return{getBootstrap:function(){return window.bootstrap||null},init:function(e){this.categoryId=e,this.setupEventHandlers(),this.loadPrices()},setupEventHandlers:function(){var t=this;p(document).on("click","#btn-add-price",function(){t.showPriceForm(null)}),p(document).on("click","#btn-save-price",function(){t.savePrice()}),p(document).on("click",".btn-edit-price",function(e){e.preventDefault();e=p(this).data("price-id");t.editPrice(e)}),p(document).on("click",".btn-delete-price",function(e){e.preventDefault();e=p(this).data("price-id");t.deletePrice(e)})},loadPrices:function(){var a=this;p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:{action:"getprices",categoryid:a.categoryId,activeonly:!0},success:function(e){e.success&&e.data?a.renderPricesTable(e.data):a.renderPricesTable([])},error:function(e,t,r){console.log("No prices loaded or service error:",r),a.renderPricesTable([])}})},renderPricesTable:function(e){var r=p("#prices-tbody");r.html(""),e&&0!==e.length?e.forEach(function(e){var t="<tr>",t=(t=(t=(t+="<td><strong>"+(e.name||"-")+"</strong></td>")+("<td>R$ "+parseFloat(e.price).toFixed(2)+"</td>"))+("<td>"+new Date(1e3*e.startdate).toLocaleString()+"</td>"))+("<td>"+(e.enddate?new Date(1e3*e.enddate).toLocaleString():"-")+"</td>");r.append(t=(t=(t=(t=(t+='<td><span class="badge '+(1==e.ispromotional?"bg-warning":"bg-secondary")+'">'+(1==e.ispromotional?"Yes":"No")+"</span></td>")+('<td><span class="badge '+(1==e.isenrollmentfee?"bg-info":"bg-secondary")+'">'+(1==e.isenrollmentfee?"Yes":"No")+"</span></td>")+("<td>"+e.installments+"</td>"))+('<td><span class="badge '+(1==e.status?"bg-success":"bg-danger")+'">'+(1==e.status?"Active":"Inactive")+"</span></td>")+"<td>")+('<button type="button" class="btn btn-sm btn-warning me-2 btn-edit-price" data-price-id="'+e.id+'"><i class="fas fa-edit"></i></button>')+('<button type="button" class="btn btn-sm btn-danger btn-delete-price" data-price-id="'+e.id+'"><i class="fas fa-trash"></i></button>'))+"</td>"+"</tr>")}):r.html('<tr><td colspan="9" class="text-center text-muted">No prices found. Click "Add Price" to create one.</td></tr>')},showPriceForm:function(e){var t=this,r=e?"Edit Price":"Add Price",r=(t.hideErrorAlert(),p("#priceModalLabel").text(r),e?(p("#price_id").val(e.id),p("#price-name").val(e.name||""),p("#price-value").val(e.price),p("#validity-start").val(new Date(1e3*e.startdate).toISOString().slice(0,16)),p("#validity-end").val(e.enddate?new Date(1e3*e.enddate).toISOString().slice(0,16):""),p("#is-promotional").prop("checked",1==e.ispromotional),p("#is-enrollment-fee").prop("checked",1==e.isenrollmentfee),p("#scheduled-task").prop("checked",1==e.scheduledtask),p("#installments").val(e.installments||0),p("#price-status").val(e.status)):(t.resetPriceForm(),t.initializeDateFields()),t.getBootstrap());r&&new r.Modal(document.getElementById("priceModal")).show()},initializeDateFields:function(){var e=new Date,t=(e.setHours(0,0,0,0),this.formatDateForInput(e)),t=(p("#validity-start").val(t),new Date(e)),e=(t.setFullYear(t.getFullYear()+5),this.formatDateForInput(t));p("#validity-end").val(e)},formatDateForInput:function(e){return e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")+"T"+String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")},editPrice:function(t){var r=this;p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:{action:"getprices",categoryid:r.categoryId,activeonly:!1},success:function(e){e.success&&e.data&&(e=e.data.find(function(e){return e.id==t}))&&r.showPriceForm(e)},error:function(){r.showErrorAlert("Failed to load price details")}})},savePrice:function(){var a=this,r=p("#price_id").val(),e=p("#price-name").val(),t=p("#price-value").val(),i=new Date(p("#validity-start").val()).getTime()/1e3,n=p("#validity-end").val()?new Date(p("#validity-end").val()).getTime()/1e3:null,o=p("#is-promotional").is(":checked")?1:0,c=p("#is-enrollment-fee").is(":checked")?1:0,s=p("#scheduled-task").is(":checked")?1:0,l=parseInt(p("#installments").val())||0,d=p("#price-status").val();e&&""!==e.trim()?!t||t<=0?u.alert("Please enter a valid price","Validation Error"):!i||isNaN(i)?u.alert("Please enter a valid start date","Validation Error"):l<0?u.alert("Installments cannot be negative","Validation Error"):(e={action:r?"updateprice":"createprice",categoryid:a.categoryId,name:e,price:t,startdate:i,enddate:n||null,ispromotional:o,isenrollmentfee:c,scheduledtask:s,installments:l,status:d},r&&(e.id=r),p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:e,success:function(e){var t;e.success?((t=a.getBootstrap())&&(t=t.Modal.getInstance(document.getElementById("priceModal")))&&t.hide(),a.loadPrices(),u.alert(r?"Price updated successfully":"Price created successfully","Success")):a.showErrorAlert(e.error||"Error saving price")},error:function(e,t,r){console.error("Error saving price:",r);r="Failed to save price";try{e.responseJSON&&e.responseJSON.error&&(r=e.responseJSON.error)}catch(e){}a.showErrorAlert(r)}})):u.alert("Please enter a price name","Validation Error")},showErrorAlert:function(e){var t=p("#price-alert");p("#price-alert-message").text(e),t.removeClass("alert-success alert-info").addClass("alert-danger"),t.show(),setTimeout(function(){t.fadeOut()},5e3)},hideErrorAlert:function(){p("#price-alert").hide().removeClass("alert-danger alert-success alert-info")},deletePrice:function(e){var t=this;confirm("Are you sure you want to delete this price?")&&p.ajax({type:"POST",url:M.cfg.wwwroot+"/local/localcustomadmin/ajax/price_action.php",dataType:"json",data:{action:"deleteprice",id:e},success:function(e){e.success?(t.loadPrices(),u.alert("Price deleted successfully","Success")):u.alert(e.error||"Error deleting price","Error")},error:function(){u.exception(new Error("Failed to delete price"))}})},resetPriceForm:function(){p("#price-form")[0].reset(),p("#price_id").val("")}}});
//# sourceMappingURL=price_manager.min.js.map